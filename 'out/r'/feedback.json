{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "feedback",
  "type": "registry:component",
  "title": "Feedback",
  "description": "A feedback component with popover form.",
  "dependencies": [
    "@hookform/resolvers",
    "react-hook-form",
    "sonner",
    "zod",
    "lucide-react",
    "class-variance-authority"
  ],
  "registryDependencies": [
    "button",
    "form",
    "popover",
    "textarea"
  ],
  "files": [
    {
      "path": "src/components/feedback.tsx",
      "content": "\"use client\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Form,\r\n  FormControl,\r\n  FormField,\r\n  FormItem,\r\n  FormLabel,\r\n} from \"@/components/ui/form\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport { Inbox, LoaderCircle } from \"lucide-react\";\r\nimport { useEffect, useState, useTransition } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { toast } from \"sonner\";\r\nimport { z } from \"zod\";\r\n\r\nconst schema = z.object({\r\n  message: z.string().min(1),\r\n});\r\n\r\nexport function Feedback({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof Button>) {\r\n  const [open, setOpen] = useState(false);\r\n  const isMobile = useIsMobile();\r\n  const form = useForm<z.infer<typeof schema>>({\r\n    resolver: zodResolver(schema),\r\n    defaultValues: {\r\n      message: \"\",\r\n    },\r\n  });\r\n  const [isSuccess, setIsSuccess] = useState(false);\r\n  const [pending, startTransition] = useTransition();\r\n\r\n  const onSubmit = (values: z.infer<typeof schema>) => {\r\n    startTransition(async () => {\r\n      const promise = new Promise<void>((resolve) => {\r\n        setTimeout(() => {\r\n          setIsSuccess(true);\r\n          resolve();\r\n        }, 1000);\r\n      });\r\n      console.log(values);\r\n      toast.promise(promise, {\r\n        loading: \"Sending feedback...\",\r\n        success: \"Feedback sent!\",\r\n        error: \"Failed to send feedback\",\r\n      });\r\n      await promise;\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!open && isSuccess) {\r\n      // NOTE: the popover takes 300ms to close, so we need to wait for that\r\n      setTimeout(() => setIsSuccess(false), 300);\r\n    }\r\n  }, [open, isSuccess]);\r\n\r\n  useEffect(() => {\r\n    const down = (e: KeyboardEvent) => {\r\n      if (open && (e.metaKey || e.ctrlKey) && e.key === \"Enter\") {\r\n        form.handleSubmit(onSubmit)();\r\n      }\r\n\r\n      const target = e.target as HTMLElement;\r\n      const isTyping =\r\n        target.tagName === \"INPUT\" ||\r\n        target.tagName === \"TEXTAREA\" ||\r\n        target.isContentEditable;\r\n\r\n      if (isTyping) return;\r\n\r\n      if (!open) {\r\n        if (e.key === \"f\") {\r\n          e.preventDefault();\r\n          setOpen(true);\r\n        }\r\n        return;\r\n      }\r\n    };\r\n    document.addEventListener(\"keydown\", down);\r\n    return () => document.removeEventListener(\"keydown\", down);\r\n  }, [open, form, onSubmit]);\r\n\r\n  useEffect(() => {\r\n    if (!open) {\r\n      form.reset();\r\n    }\r\n  }, [open, form]);\r\n\r\n  if (isMobile) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Popover open={open} onOpenChange={setOpen}>\r\n      <PopoverTrigger asChild>\r\n        <Button\r\n          variant=\"ghost\"\r\n          size=\"sm\"\r\n          className={cn(\r\n            \"group gap-0 px-2 text-muted-foreground text-sm hover:bg-transparent hover:text-foreground data-[state=open]:text-foreground\",\r\n            className\r\n          )}\r\n          {...props}\r\n        >\r\n          Feedback{\" \"}\r\n          <kbd className=\"bg-background text-muted-foreground/70 ms-2 -me-1 inline-flex h-5 max-h-full items-center rounded border px-1 text-[0.625rem] font-medium font-mono group-hover:text-foreground group-data-[state=open]:text-foreground\">\r\n            F\r\n          </kbd>\r\n        </Button>\r\n      </PopoverTrigger>\r\n      <PopoverContent align=\"end\" className=\"relative border-none p-0\">\r\n        {isSuccess ? (\r\n          <div className=\"flex h-[110px] flex-col items-center justify-center gap-1 rounded-md border border-input p-3 text-base shadow-xs\">\r\n            <Inbox className=\"size-4 shrink-0\" />\r\n            <p className=\"text-center font-medium\">Thanks for sharing!</p>\r\n            <p className=\"text-center text-muted-foreground text-sm\">\r\n              We&apos;ll get in touch if there&apos;s a follow-up.\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <Form {...form}>\r\n            <form onSubmit={form.handleSubmit(onSubmit)}>\r\n              <FormField\r\n                control={form.control}\r\n                name=\"message\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel className=\"sr-only\">Feedback</FormLabel>\r\n                    <FormControl>\r\n                      <Textarea\r\n                        placeholder=\"Ideas, bugs, or anything else...\"\r\n                        className=\"field-sizing-fixed h-[110px] resize-none p-3\"\r\n                        rows={4}\r\n                        {...field}\r\n                      />\r\n                    </FormControl>\r\n                  </FormItem>\r\n                )}\r\n              />\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"group absolute right-1.5 bottom-1.5 gap-0\"\r\n                type=\"submit\"\r\n                disabled={pending}\r\n              >\r\n                {pending ? (\r\n                  <LoaderCircle className=\"size-4 animate-spin\" />\r\n                ) : (\r\n                  <>\r\n                    Send\r\n                    <kbd className=\"bg-background text-muted-foreground/70 ms-2 -me-1 inline-flex h-5 max-h-full items-center rounded border px-1 text-[0.625rem] font-medium font-mono group-hover:text-foreground\">\r\n                      ⌘\r\n                    </kbd>\r\n                    <kbd className=\"bg-background text-muted-foreground/70 ms-2 -me-1 inline-flex h-5 max-h-full items-center rounded border px-1 text-[0.625rem] font-medium font-mono group-hover:text-foreground\">\r\n                      ↵\r\n                    </kbd>\r\n                  </>\r\n                )}\r\n              </Button>\r\n            </form>\r\n          </Form>\r\n        )}\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n}\r\n",
      "type": "registry:component"
    }
  ]
}